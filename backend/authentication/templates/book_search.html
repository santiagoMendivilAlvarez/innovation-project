{% extends 'utils/base_auth.html' %}

{% block title %}Buscar Libros - BookieWookie{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f5f7fa;
    }

    .search-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    .search-header {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .search-box {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .search-input {
        flex: 1;
        padding: 0.875rem 1.25rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        outline: none;
        transition: all 0.3s;
    }

    .search-input:focus {
        border-color: #1976d2;
        box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .search-btn {
        background: #1976d2;
        color: white;
        border: none;
        padding: 0.875rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        white-space: nowrap;
    }

    .search-btn:hover {
        background: #1565c0;
        transform: translateY(-1px);
    }

    .search-info {
        color: #666;
        font-size: 0.95rem;
    }

    .results-container {
        display: flex;
        gap: 2rem;
    }

    .filters-sidebar {
        width: 280px;
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        height: fit-content;
        position: sticky;
        top: 2rem;
    }

    .filter-section {
        margin-bottom: 2rem;
    }

    .filter-title {
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 1rem;
        color: #333;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .filter-option {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0;
        cursor: pointer;
        font-size: 0.9rem;
        color: #666;
    }

    .filter-option:hover {
        color: #1976d2;
    }

    .filter-option input[type="checkbox"] {
        cursor: pointer;
    }

    .results-main {
        flex: 1;
    }

    .results-header {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .results-count {
        font-size: 0.95rem;
        color: #666;
    }

    .sort-options {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .sort-label {
        font-size: 0.9rem;
        color: #666;
    }

    .sort-select {
        padding: 0.5rem 1rem;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-size: 0.9rem;
        cursor: pointer;
        outline: none;
    }

    .view-toggle {
        display: flex;
        gap: 0.5rem;
    }

    .view-btn {
        padding: 0.5rem;
        border: 1px solid #e0e0e0;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .view-btn.active {
        background: #1976d2;
        color: white;
        border-color: #1976d2;
    }

    .books-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .book-item {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        display: flex;
        gap: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        transition: all 0.3s;
        cursor: pointer;
        position: relative;
        border: 1px solid #e0e0e0;
    }

    .book-item:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transform: translateY(-2px);
        border-color: #1976d2;
    }

    .book-thumbnail {
        width: 140px;
        height: 200px;
        border-radius: 4px;
        object-fit: cover;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 3rem;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .book-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 4px;
    }

    .book-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .book-title {
        font-size: 1.15rem;
        font-weight: 600;
        color: #1976d2;
        margin: 0 0 0.5rem 0;
        line-height: 1.4;
        cursor: pointer;
    }

    .book-title:hover {
        text-decoration: underline;
    }

    .book-author {
        font-size: 0.9rem;
        color: #555;
        margin: 0 0 0.75rem 0;
    }

    .book-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        font-size: 0.85rem;
        margin-bottom: 0.75rem;
    }

    .book-meta-item {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        background: #f5f5f5;
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
        font-size: 0.8rem;
        color: #666;
        border: 1px solid #e0e0e0;
    }

    .book-meta-item svg,
    .book-meta-item .icon {
        width: 14px;
        height: 14px;
    }

    .book-description {
        font-size: 0.9rem;
        color: #666;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .book-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: auto;
    }

    .book-price {
        font-size: 1.25rem;
        font-weight: 700;
        color: #2e7d32;
    }

    .book-source {
        display: inline-flex;
        align-items: center;
        padding: 0.35rem 0.85rem;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .source-google {
        background: #e8f0fe;
        color: #1967d2;
        border: 1px solid #d2e3fc;
    }

    .source-amazon {
        background: #fff3e0;
        color: #e65100;
        border: 1px solid #ffe0b2;
    }

    .view-btn-action {
        padding: 0.6rem 1.5rem;
        background: #2196F3;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.85rem;
        box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3);
    }

    .view-btn-action:hover {
        background: #1976d2;
        box-shadow: 0 4px 8px rgba(33, 150, 243, 0.4);
        transform: translateY(-1px);
    }

    .no-results {
        background: white;
        padding: 3rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .no-results-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .no-results-text {
        font-size: 1.2rem;
        color: #666;
        margin-bottom: 0.5rem;
    }

    .no-results-subtext {
        font-size: 0.95rem;
        color: #999;
    }

    .error-message {
        background: #fff3e0;
        border-left: 4px solid #ff9800;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: #e65100;
    }

    @media (max-width: 968px) {
        .results-container {
            flex-direction: column;
        }

        .filters-sidebar {
            width: 100%;
            position: static;
        }

        .book-item {
            flex-direction: column;
        }

        .book-thumbnail {
            width: 100%;
            height: 200px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="search-container">
    <!-- Search Header -->
    <div class="search-header">
        <form class="search-box" method="GET" action="{% url 'book_search' %}">
            <input 
                type="text" 
                class="search-input" 
                name="search" 
                placeholder="Buscar libros por t√≠tulo, autor, ISBN..." 
                value="{{ search_query }}"
                required
            >
            <button type="submit" class="search-btn">üîç Buscar</button>
        </form>
        {% if search_query %}
        <div class="search-info">
            Mostrando resultados para "<strong>{{ search_query }}</strong>"
        </div>
        {% endif %}
    </div>

    <!-- Results Container -->
    <div class="results-container">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar">
            <div class="filter-section">
                <h3 class="filter-title">üìö Formato</h3>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>Todos los formatos</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Tapa dura</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Tapa blanda</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Digital</span>
                </label>
            </div>

            <div class="filter-section">
                <h3 class="filter-title">üè∑Ô∏è Disponibilidad</h3>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>En stock</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Preventa</span>
                </label>
            </div>

            <div class="filter-section">
                <h3 class="filter-title">üõí Plataforma</h3>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>Google Books</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>Amazon</span>
                </label>
            </div>
        </aside>

        <!-- Main Results -->
        <main class="results-main">
            {% if google_error or amazon_error %}
                {% if google_error %}
                <div class="error-message">
                    <strong>‚ö†Ô∏è Google Books:</strong> {{ google_error }}
                </div>
                {% endif %}
                {% if amazon_error %}
                <div class="error-message">
                    <strong>‚ö†Ô∏è Amazon:</strong> {{ amazon_error }}
                </div>
                {% endif %}
            {% endif %}

            {% if has_results %}
            <!-- Results Header -->
            <div class="results-header">
                <div class="results-count">
                    Mostrando <strong>{{ total_results }}</strong> resultado{{ total_results|pluralize }}
                </div>
                <div class="sort-options">
                    <span class="sort-label">Ordenar por:</span>
                    <select class="sort-select">
                        <option value="relevance">Relevancia</option>
                        <option value="price_low">Precio: Menor a Mayor</option>
                        <option value="price_high">Precio: Mayor a Menor</option>
                        <option value="date">M√°s recientes</option>
                    </select>
                    <div class="view-toggle">
                        <button class="view-btn active" title="Vista de lista">‚ò∞</button>
                        <button class="view-btn" title="Vista de cuadr√≠cula">‚äû</button>
                    </div>
                </div>
            </div>

            <!-- Books List -->
            <div class="books-list">
                {% for book in books %}
                <div class="book-item" onclick="window.location.href='{% url 'book_detail' book.book_id|default:'unknown' %}?title={{ book.title|urlencode }}&author={% if book.authors %}{{ book.authors.0|urlencode }}{% endif %}&source={{ book.source|urlencode }}&thumbnail={{ book.thumbnail|urlencode }}&price={{ book.price|default:'N/A'|urlencode }}'">
                    <div class="book-thumbnail">
                        {% if book.thumbnail %}
                            <img src="{{ book.thumbnail }}" alt="{{ book.title }}">
                        {% else %}
                            üìñ
                        {% endif %}
                    </div>
                    <div class="book-details">
                        <h3 class="book-title">{{ book.title }}</h3>
                        {% if book.authors %}
                        <p class="book-author">Autor: {{ book.authors|join:", " }}</p>
                        {% endif %}
                        
                        <div class="book-meta">
                            <span class="book-source {% if book.source == 'Google Books' %}source-google{% else %}source-amazon{% endif %}">
                                {{ book.source }}
                            </span>
                            {% if book.publishedDate and book.publishedDate != 'N/A' %}
                            <span class="book-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                {{ book.publishedDate }}
                            </span>
                            {% endif %}
                            {% if book.pageCount and book.pageCount != 'N/A' %}
                            <span class="book-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                    <polyline points="13 2 13 9 20 9"></polyline>
                                </svg>
                                {{ book.pageCount }} p√°ginas
                            </span>
                            {% endif %}
                            {% if book.publisher and book.publisher != 'N/A' %}
                            <span class="book-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                </svg>
                                {{ book.publisher }}
                            </span>
                            {% endif %}
                            {% if book.categories %}
                            <span class="book-meta-item" style="background: #e8f5e9; color: #2e7d32; border-color: #c8e6c9;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                </svg>
                                {{ book.categories.0 }}
                            </span>
                            {% endif %}
                        </div>

                        {% if book.description and book.description != 'N/A' %}
                        <p class="book-description">{{ book.description }}</p>
                        {% endif %}

                        <div class="book-actions">
                            {% if book.price and book.price != 'N/A' %}
                            <span class="book-price">{{ book.price }}</span>
                            {% endif %}
                            {% if book.rating and book.rating != 'N/A' %}
                            <span style="font-size: 0.85rem; color: #ff9800;">‚≠ê {{ book.rating }}</span>
                            {% endif %}
                            <button class="view-btn-action" onclick="event.stopPropagation();">Ver detalles</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
                {% if search_query %}
                <div class="no-results">
                    <div class="no-results-icon">üîç</div>
                    <h2 class="no-results-text">No se encontraron resultados</h2>
                    <p class="no-results-subtext">
                        No encontramos libros para "{{ search_query }}". 
                        <br>Intenta con otros t√©rminos de b√∫squeda.
                    </p>
                </div>
                {% else %}
                <div class="no-results">
                    <div class="no-results-icon">üìö</div>
                    <h2 class="no-results-text">Busca tu pr√≥ximo libro</h2>
                    <p class="no-results-subtext">
                        Usa el buscador para encontrar el libro que est√°s buscando.
                    </p>
                </div>
                {% endif %}
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}

