{% extends 'utils/base.html' %}

{% block title %}Buscar Libros - BookieWookie{% endblock %}

{% block content %}
<div class="search-container">
    <!-- Search Header -->
    <div class="search-header">
        <form class="search-box" method="GET" action="{% url 'book_search' %}">
            <input 
                type="text" 
                class="search-input" 
                name="search" 
                placeholder="Buscar libros por t√≠tulo, autor, ISBN..." 
                value="{{ search_query }}"
                required
            >
            <button type="submit" class="search-btn">üîç Buscar</button>
        </form>
        {% if search_query %}
        <div class="search-info">
            Mostrando resultados para "<strong>{{ search_query }}</strong>"
        </div>
        {% endif %}
    </div>

    <!-- Results Container -->
    <div class="results-container">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar">
            <div class="filter-section">
                <h3 class="filter-title">üìö Formato</h3>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>Todos los formatos</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Tapa dura</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Tapa blanda</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Digital</span>
                </label>
            </div>

            <div class="filter-section">
                <h3 class="filter-title">üè∑Ô∏è Disponibilidad</h3>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>En stock</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox">
                    <span>Preventa</span>
                </label>
            </div>

            <div class="filter-section">
                <h3 class="filter-title">üõí Plataforma</h3>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>Google Books</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" checked>
                    <span>Amazon</span>
                </label>
            </div>
        </aside>

        <!-- Main Results -->
        <main class="results-main">
            {% if google_error or amazon_error %}
                {% if google_error %}
                <div class="error-message">
                    <strong>‚ö†Ô∏è Google Books:</strong> {{ google_error }}
                </div>
                {% endif %}
                {% if amazon_error %}
                <div class="error-message">
                    <strong>‚ö†Ô∏è Amazon:</strong> {{ amazon_error }}
                </div>
                {% endif %}
            {% endif %}

            {% if has_results %}
            <!-- Results Header -->
            <div class="results-header">
                <div class="results-count">
                    Mostrando <strong>{{ total_results }}</strong> resultado{{ total_results|pluralize }}
                </div>
                <div class="sort-options">
                    <span class="sort-label">Ordenar por:</span>
                    <select class="sort-select">
                        <option value="relevance">Relevancia</option>
                        <option value="price_low">Precio: Menor a Mayor</option>
                        <option value="price_high">Precio: Mayor a Menor</option>
                        <option value="date">M√°s recientes</option>
                    </select>
                    <div class="view-toggle">
                        <button class="view-btn active" title="Vista de lista">‚ò∞</button>
                        <button class="view-btn" title="Vista de cuadr√≠cula">‚äû</button>
                    </div>
                </div>
            </div>

            <!-- Books List -->
            <div class="books-list">
                {% for book in books %}
                <div class="book-item" onclick="window.location.href='{% url 'book_detail' book.book_id|default:'unknown' %}?title={{ book.title|urlencode }}&author={% if book.authors %}{{ book.authors.0|urlencode }}{% endif %}&source={{ book.source|urlencode }}&thumbnail={{ book.thumbnail|urlencode }}&price={{ book.price|default:'N/A'|urlencode }}'">
                    <div class="book-thumbnail">
                        {% if book.thumbnail %}
                            <img src="{{ book.thumbnail }}" alt="{{ book.title }}">
                        {% else %}
                            üìñ
                        {% endif %}
                    </div>
                    <div class="book-details">
                        <h3 class="book-title">{{ book.title }}</h3>
                        {% if book.authors %}
                        <p class="book-author">Autor: {{ book.authors|join:", " }}</p>
                        {% endif %}
                        
                        <div class="book-meta">
                            <span class="book-source {% if book.source == 'Google Books' %}source-google{% else %}source-amazon{% endif %}">
                                {{ book.source }}
                            </span>
                            {% if book.publishedDate and book.publishedDate != 'N/A' %}
                            <span class="book-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                {{ book.publishedDate }}
                            </span>
                            {% endif %}
                            {% if book.pageCount and book.pageCount != 'N/A' %}
                            <span class="book-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                    <polyline points="13 2 13 9 20 9"></polyline>
                                </svg>
                                {{ book.pageCount }} p√°ginas
                            </span>
                            {% endif %}
                            {% if book.publisher and book.publisher != 'N/A' %}
                            <span class="book-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                </svg>
                                {{ book.publisher }}
                            </span>
                            {% endif %}
                            {% if book.categories %}
                            <span class="book-meta-item" style="background: #e8f5e9; color: #2e7d32; border-color: #c8e6c9;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                </svg>
                                {{ book.categories.0 }}
                            </span>
                            {% endif %}
                        </div>

                        {% if book.description and book.description != 'N/A' %}
                        <p class="book-description">{{ book.description }}</p>
                        {% endif %}

                        <div class="book-actions">
                            {% if book.price and book.price != 'N/A' %}
                            <span class="book-price">{{ book.price }}</span>
                            {% endif %}
                            {% if book.rating and book.rating != 'N/A' %}
                            <span style="font-size: 0.85rem; color: #ff9800;">‚≠ê {{ book.rating }}</span>
                            {% endif %}
                            <button class="view-btn-action" onclick="event.stopPropagation();">Ver detalles</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
                {% if search_query %}
                <div class="no-results">
                    <div class="no-results-icon">üîç</div>
                    <h2 class="no-results-text">No se encontraron resultados</h2>
                    <p class="no-results-subtext">
                        No encontramos libros para "{{ search_query }}". 
                        <br>Intenta con otros t√©rminos de b√∫squeda.
                    </p>
                </div>
                {% else %}
                <div class="no-results">
                    <div class="no-results-icon">üìö</div>
                    <h2 class="no-results-text">Busca tu pr√≥ximo libro</h2>
                    <p class="no-results-subtext">
                        Usa el buscador para encontrar el libro que est√°s buscando.
                    </p>
                </div>
                {% endif %}
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}

